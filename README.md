# deployfilegen

[![PyPI version](https://img.shields.io/pypi/v/deployfilegen.svg)](https://pypi.org/project/deployfilegen/)
[![Downloads](https://img.shields.io/pypi/dm/deployfilegen.svg)](https://pypi.org/project/deployfilegen/)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)

**deployfilegen** is a production-grade Python CLI that auto-generates **Dockerfiles**, **docker-compose.yml**, and **GitHub Actions** workflows for Django + React/Next.js/Vite projects.

**One command. Zero config. Production-ready.**

```bash
pip install deployfilegen
deployfilegen init --mode dev     # Dev environment â€” just works
deployfilegen init --mode prod    # Production â€” hardened & optimized
```

---

## âš¡ Demo

```bash
$ deployfilegen init --mode dev

Generating Backend Dockerfile...
Generated backend/Dockerfile
Generating Frontend Dockerfile...
Generated frontend/Dockerfile
Generating Docker Compose...
Generated docker-compose.dev.yml
Deployment configuration generated successfully!

$ docker compose -f docker-compose.dev.yml up --build
# âœ… Backend at http://localhost:8000
# âœ… Frontend at http://localhost:5173 (Vite auto-detected)
```

---

## ğŸ“ Expected Project Structure

```
my-project/
â”œâ”€â”€ .env                    # Your environment variables
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ manage.py           # Django project
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ package.json        # React/Vite/Next.js
â”‚   â””â”€â”€ src/
â”‚
â”‚â”€â”€ # Generated by deployfilegen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ backend/Dockerfile      â† generated
â”œâ”€â”€ frontend/Dockerfile     â† generated
â”œâ”€â”€ docker-compose.dev.yml  â† generated (dev mode)
â”œâ”€â”€ docker-compose.prod.yml â† generated (prod mode)
â””â”€â”€ .github/workflows/
    â””â”€â”€ deploy.yml          â† generated (prod mode)
```

---

## ğŸš€ Key Features

- **Zero-Config Dev Mode**: Works with *any* existing `.env` file. No forced variable naming.
- **Smart Framework Detection**: Auto-detects **Vite** (port 5173), **Next.js** (port 3000), or **CRA**.
- **Flexible Deployment**: SSH Build (default) or Registry Push â€” you choose.
- **Production-Grade Defaults**:
    - Non-root users, unprivileged Nginx
    - Healthchecks, restart policies
    - Multi-stage builds, `.dockerignore` generation

---

## ğŸ“¦ Deployment Strategies

### SSH Build (Default â€” No Registry Needed)

```bash
deployfilegen init --mode prod --deploy ssh
```

**Required `.env` (only 2 variables!):**
```ini
DEPLOY_HOST=your_server_ip
DEPLOY_USER=ubuntu
```

**CI/CD workflow:** `SSH â†’ git pull â†’ docker compose build â†’ up -d`

### Registry Push (Advanced â€” Immutable Deployments)

```bash
deployfilegen init --mode prod --deploy registry
```

**Required `.env`:**
```ini
# Always required
DEPLOY_HOST=your_server_ip
DEPLOY_USER=ubuntu

# Only for --deploy registry
DOCKER_USERNAME=your_username
BACKEND_IMAGE_NAME=user/backend
FRONTEND_IMAGE_NAME=user/frontend
```

**CI/CD workflow:** `Build â†’ Push to Registry â†’ SSH â†’ docker compose pull â†’ up -d`

---

## ğŸ›  Supported Stacks

| Component | Framework | Auto-Detected |
|:---|:---|:---|
| **Backend** | Django | Project name from `manage.py` |
| **Frontend** | Vite | Port `5173`, `--host` binding |
| **Frontend** | Next.js | Port `3000`, `-H` binding |
| **Frontend** | CRA | Port `3000`, `HOST` env |

---

## âš™ï¸ Configuration

Generate a boilerplate `.env`:
```bash
deployfilegen template                    # SSH mode (minimal)
deployfilegen template --deploy registry  # Registry mode (full)
```

---

## ğŸ“– CLI Reference

```text
Usage: deployfilegen init [OPTIONS]

Options:
  --mode [dev|prod]       Generation mode (Default: prod)
  --deploy [ssh|registry] Deployment strategy (Default: ssh)
  --force, -f             Overwrite existing files
  --with-db               Include a Postgres service

  # Scope Control
  --docker-only           Generate only Dockerfiles
  --compose-only          Generate only docker-compose.yml
  --github-only           Generate only GitHub Actions (Prod only)
  --backend-only          Only generate backend assets
  --frontend-only         Only generate frontend assets

  # Override Detection
  --frontend-port INT     Override detected frontend dev port
  --start-command TEXT    Override detected frontend start command
  --project-name TEXT     Override detected Django project name

  --help                  Show this message
```

---

## ğŸ”§ Troubleshooting

**"Missing required variables" error in prod mode?**
```bash
deployfilegen template              # SSH: just DEPLOY_HOST + DEPLOY_USER
deployfilegen template --deploy registry  # Registry: adds DOCKER_USERNAME + IMAGE_NAMEs
```

**Frontend container exits immediately?**
```bash
deployfilegen init --mode dev --start-command "serve" --force
```

**Wrong port detected?**
```bash
deployfilegen init --mode dev --frontend-port 8080 --force
```

**Django project name wrong?**
```bash
deployfilegen init --mode prod --project-name my_project --force
```

---

## ğŸ“„ License
MIT
